
## daily note
-  conda [allDay:: true]
conda eviorn name psychopy


conda create -n psychopy python=3.10 -y
conda activate psychopy

```
#                                                                               
# To activate this environment, use                                             
#                                                                               
#     $ conda activate psychopy                                                 
#                                                                               
# To deactivate an active environment, use                                      
#                                                                               
#     $ conda deactivate 
```



### 1. 使用“三剑客”环境变量启动

这组变量专门解决 `Gdk-CRITICAL` 导致的设备识别失败和渲染卡顿：

Bash

```
# 激活环境
conda activate psychopy

# 合并多个修复参数
export GDK_CORE_DEVICE_EVENTS=1
export WEBKIT_DISABLE_COMPOSITING_MODE=1
export GDK_BACKEND=x11

# 尝试启动
python -m psychopy.app.psychopyApp
```

---

### 2. 绕过“欢迎界面”和“自动检查更新”

PsychoPy 的欢迎界面（那个带 Logo 的小图）在 Linux + NVIDIA 环境下是出名的“卡死诱因”。我们可以通过修改配置文件，直接进入主界面。

请执行以下命令来修改配置文件（即使它还没完全生成）：

Bash

```
# 1. 确保目录存在
mkdir -p ~/.psychopy3

# 2. 强制关闭启动时的欢迎图和自动更新检查
cat <<EOF > ~/.psychopy3/appData.cfg
[General]
    showSplash = False
    checkUpdates = False
EOF
```



### 方案一：使用“线程补丁”脚本启动（最有效）

我们通过 `ctypes` 强制调用系统底层的 `XInitThreads`。请在终端执行以下命令，创建一个特殊的启动脚本：

1. **创建修复脚本：**
    
    Bash
    
    ```
    cat <<EOF > ~/fix_psychopy.py
    import ctypes
    import os
    
    # 核心修复：在导入任何其他库之前初始化 X11 线程
    try:
        x11 = ctypes.cdll.LoadLibrary('libX11.so')
        x11.XInitThreads()
        print("XInitThreads initialized successfully.")
    except Exception as e:
        print(f"Warning: Could not initialize XInitThreads: {e}")
    
    # 禁用可能导致冲突的环境变量
    os.environ['dbus_fatal_warnings'] = '0'
    
    # 启动 PsychoPy
    from psychopy.app import psychopyApp
    psychopyApp.main()
    EOF
    ```
    
2. **使用该脚本启动：**
    
    Bash
    
    ```
    python ~/fix_psychopy.py
    ```
